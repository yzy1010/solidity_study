# NFT Auction Market

## Overview
è¿™æ˜¯ä¸€ä¸ªåŸºäº Hardhat æ¡†æ¶å¼€å‘çš„ NFT æ‹å–å¸‚åœºé¡¹ç›®ï¼Œé›†æˆäº† Chainlink é¢„è¨€æœºåŠŸèƒ½å’Œ UUPS å¯å‡çº§ä»£ç†æ¨¡å¼ã€‚é¡¹ç›®å®ç°äº†å®Œæ•´çš„ NFT æ‹å–åŠŸèƒ½ï¼Œæ”¯æŒ ETH å’Œ ERC20 ä»£å¸å‡ºä»·ï¼Œå¹¶æä¾›äº†ç¾å…ƒä»·æ ¼æ¯”è¾ƒã€‚

## Features ğŸš€

### æ ¸å¿ƒåŠŸèƒ½
- ğŸ¨ **ERC721 NFT åˆçº¦** - æ”¯æŒ NFT é“¸é€ å’Œè½¬ç§»
- ğŸ›ï¸ **æ‹å–åˆçº¦** - åˆ›å»ºæ‹å–ã€å‡ºä»·ã€ç»“æŸæ‹å–çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸ
- ğŸ’° **å¤šæ”¯ä»˜æ”¯æŒ** - åŒæ—¶æ”¯æŒ ETH å’Œ ERC20 ä»£å¸å‡ºä»·
- ğŸ“Š **Chainlink é›†æˆ** - å®æ—¶ä»·æ ¼æ•°æ®ï¼ŒUSD ä»·å€¼æ¯”è¾ƒ
- ğŸ”„ **åˆçº¦å‡çº§** - æ”¯æŒ UUPS ä»£ç†æ¨¡å¼çš„åˆçº¦å‡çº§
- ğŸ›¡ï¸ **å®‰å…¨ç‰¹æ€§** - é‡å…¥ä¿æŠ¤ã€æƒé™æ§åˆ¶ã€è¾“å…¥éªŒè¯

### æŠ€æœ¯ç‰¹æ€§
- **Solidity 0.8.19** - ä½¿ç”¨æœ€æ–°ç¨³å®šç‰ˆæœ¬
- **OpenZeppelin** - å®‰å…¨çš„åˆçº¦åº“å’Œå‡çº§æ¡†æ¶
- **Chainlink é¢„è¨€æœº** - å®æ—¶ä»·æ ¼æ•°æ®è·å–
- **Hardhat** - å®Œæ•´çš„å¼€å‘æµ‹è¯•æ¡†æ¶
- **Mocha/Chai** - å…¨é¢çš„æµ‹è¯•è¦†ç›–

## Project Structure ğŸ“

```
task_three/
â”œâ”€â”€ contracts/                 # Solidity æ™ºèƒ½åˆçº¦
â”‚   â”œâ”€â”€ NFT.sol               # ERC721 NFT å®ç°
â”‚   â”œâ”€â”€ MyToken.sol           # ERC20 æ‹å–ä»£å¸
â”‚   â”œâ”€â”€ AuctionMarket.sol     # ä¸»æ‹å–å¸‚åœºåˆçº¦
â”‚   â”œâ”€â”€ PriceConsumerV3.sol   # Chainlink ä»·æ ¼æ¶ˆè´¹å™¨
â”‚   â””â”€â”€ UpgradeableAuctionMarket.sol # å¯å‡çº§æ‹å–åˆçº¦
â”œâ”€â”€ scripts/                  # éƒ¨ç½²å’Œäº¤äº’è„šæœ¬
â”‚   â”œâ”€â”€ deploy.js             # ä¸»éƒ¨ç½²è„šæœ¬
â”‚   â”œâ”€â”€ upgrade.js            # åˆçº¦å‡çº§è„šæœ¬
â”‚   â””â”€â”€ interact.js           # äº¤äº’å¼æ¼”ç¤ºè„šæœ¬
â”œâ”€â”€ test/                     # æµ‹è¯•æ–‡ä»¶
â”‚   â”œâ”€â”€ NFT.test.js           # NFT åˆçº¦æµ‹è¯•
â”‚   â”œâ”€â”€ MyToken.test.js       # ERC20 ä»£å¸æµ‹è¯•
â”‚   â””â”€â”€ AuctionMarket.test.js  # æ‹å–å¸‚åœºæµ‹è¯•
â”œâ”€â”€ deployments/              # éƒ¨ç½²è®°å½•
â”œâ”€â”€ hardhat.config.js         # Hardhat é…ç½®
â”œâ”€â”€ package.json              # ä¾èµ–å’Œè„šæœ¬
â””â”€â”€ README.md                 # é¡¹ç›®æ–‡æ¡£
```

## Smart Contracts ğŸ“‹

### NFT.sol - ERC721 NFT åˆçº¦
**åŠŸèƒ½ç‰¹æ€§:**
- æ ‡å‡†çš„ ERC721 å®ç°ï¼Œæ”¯æŒå…ƒæ•°æ®å­˜å‚¨
- æ‰€æœ‰è€…æ§åˆ¶çš„ NFT é“¸é€ 
- æ‹å–çŠ¶æ€è·Ÿè¸ªï¼ˆé˜²æ­¢æ‹å–æœŸé—´è½¬ç§»ï¼‰
- Base URI ç®¡ç†
- æ‹å–åˆçº¦é›†æˆæ¥å£

### MyToken.sol - ERC20 ä»£å¸åˆçº¦
**åŠŸèƒ½ç‰¹æ€§:**
- æ ‡å‡† ERC20 å®ç°
- æ‰€æœ‰è€…æ§åˆ¶é“¸å¸
- ç”¨äºæ‹å–å‡ºä»·çš„ä»£å¸
- åˆå§‹ä¾›åº”é‡é…ç½®

### AuctionMarket.sol - æ‹å–å¸‚åœºåˆçº¦
**åŠŸèƒ½ç‰¹æ€§:**
- è‹±å¼æ‹å–æœºåˆ¶
- æ”¯æŒ ETH å’Œ ERC20 æ”¯ä»˜
- Chainlink ä»·æ ¼é¢„è¨€æœºé›†æˆ
- è‡ªåŠ¨é€€æ¬¾ç³»ç»Ÿï¼ˆå¯¹å‡ºä»·çš„æŠ•æ ‡äººï¼‰
- å¹³å°è´¹ç”¨æ”¶å–ï¼ˆé»˜è®¤ 2.5%ï¼‰
- å…¨é¢çš„æ‹å–ç”Ÿå‘½å‘¨æœŸç®¡ç†
- æ‹å–çŠ¶æ€æŸ¥è¯¢å’Œå‡ºä»·å†å²è®°å½•

### PriceConsumerV3.sol - Chainlink ä»·æ ¼æ¶ˆè´¹å™¨
**åŠŸèƒ½ç‰¹æ€§:**
- Chainlink V3 ä»·æ ¼å–‚ä»·é›†æˆ
- å®æ—¶ USD ä»·å€¼è®¡ç®—
- å¤šèµ„äº§ä»·æ ¼æ”¯æŒ
- é”™è¯¯å¤„ç†å’Œå›é€€æœºåˆ¶

### UpgradeableAuctionMarket.sol - å¯å‡çº§æ‹å–åˆçº¦
**åŠŸèƒ½ç‰¹æ€§:**
- åŸºäº UUPS ä»£ç†æ¨¡å¼çš„å¯å‡çº§å®ç°
- å¯åˆå§‹åŒ–åˆçº¦æ¨¡å¼
- å­˜å‚¨å¸ƒå±€å…¼å®¹æ€§
- æ‰€æœ‰è€…æ§åˆ¶çš„å‡çº§åŠŸèƒ½

## Getting Started ğŸš€

### å‰ç½®è¦æ±‚
- Node.js (æ¨è v16 æˆ–æ›´é«˜)
- npm æˆ– yarn
- Git

### å®‰è£…æ­¥éª¤

1. **å…‹éš†å’Œè¿›å…¥é¡¹ç›®**
```bash
cd /path/to/solidity_study/task_three
```

2. **å®‰è£…ä¾èµ–**
```bash
npm install
```

3. **ç¯å¢ƒé…ç½®**
åˆ›å»º `.env` æ–‡ä»¶:
```env
# Infura é¡¹ç›® ID (ç”¨äºè¿æ¥ä»¥å¤ªåŠç½‘ç»œ)
INFURA_PROJECT_ID=your_infura_project_id_here

# éƒ¨ç½²è´¦æˆ·ç§é’¥ (æ°¸è¿œä¸è¦æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶)
PRIVATE_KEY=your_private_key_here

# Etherscan API å¯†é’¥ (å¯é€‰ï¼Œç”¨äºåˆçº¦éªŒè¯)
ETHERSCAN_API_KEY=your_etherscan_api_key_here
```

### ç¼–è¯‘åˆçº¦
```bash
npm run compile
```

### è¿è¡Œæµ‹è¯•
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm test

# ç”Ÿæˆæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š
npm run coverage
```

### éƒ¨ç½²åˆ°ç½‘ç»œ

#### æœ¬åœ°ç½‘ç»œ (å¼€å‘)
```bash
# å¯åŠ¨æœ¬åœ° Hardhat èŠ‚ç‚¹
npx hardhat node

# éƒ¨ç½²åˆ°æœ¬åœ°ç½‘ç»œ
npx hardhat run scripts/deploy.js --network localhost
```

#### æµ‹è¯•ç½‘ (Goerli/Sepolia)
```bash
# éƒ¨ç½²åˆ° Goerli
npx hardhat run scripts/deploy.js --network goerli

# éƒ¨ç½²åˆ° Sepolia
npx hardhat run scripts/deploy.js --network sepolia
```

## Usage Examples ğŸ“

### åŸºæœ¬å·¥ä½œæµç¨‹

1. **éƒ¨ç½²åˆçº¦**
   ```bash
   npx hardhat run scripts/deploy.js --network localhost
   ```

2. **NFT é“¸é€ **
   ```javascript
   await nft.mintNFT(recipient, "https://api.example.com/metadata/1");
   ```

3. **åˆ›å»ºæ‹å–**
   ```javascript
   await auctionMarket.createAuction(
       tokenId,
       ethers.utils.parseEther("1.0"),    // èµ·å§‹ä»·æ ¼: 1 ETH
       ethers.utils.parseEther("1.5"),    // ä¿ç•™ä»·æ ¼: 1.5 ETH
       24 * 60 * 60,                     // æŒç»­æ—¶é—´: 24 å°æ—¶
       false                              // false=ETHæ”¯ä»˜, true=ERC20æ”¯ä»˜
   );
   ```

4. **å‡ºä»·**
   ETH æ‹å–:
   ```javascript
   await auctionMarket.placeBid(auctionId, {
       value: ethers.utils.parseEther("2.0")
   });
   ```

   ERC20 æ‹å–:
   ```javascript
   await token.approve(auctionMarket.address, bidAmount);
   await auctionMarket.placeBid(auctionId);
   ```

5. **ç»“æŸæ‹å–**
   ```javascript
   await auctionMarket.endAuction(auctionId);
   ```

6. **ç´¢èµ”é€€æ¬¾** (å¯¹è¢«è¶…ä»·çš„æŠ•æ ‡äºº)
   ```javascript
   await auctionMarket.claimRefund(auctionId);
   ```

### äº¤äº’å¼æ¼”ç¤º
```bash
# è¿è¡Œäº¤äº’æ¼”ç¤ºè„šæœ¬
npx hardhat run scripts/interact.js --network localhost
```

## Chainlink é¢„è¨€æœºé…ç½® ğŸ“Š

### æµ‹è¯•ç½‘ä»·æ ¼å–‚ä»·åœ°å€
- **ETH/USD (Goerli)**: `0x694AA1769357215DE4FAC081bf1f309aDC325306`
- **ETH/USD (Sepolia)**: `0x694AA1769357215DE4FAC081bf1f309aDC325306`

### ç”Ÿäº§ç¯å¢ƒé…ç½®
å¯¹äºç”Ÿäº§éƒ¨ç½²ï¼Œè¯·æ›´æ–°éƒ¨ç½²è„šæœ¬ä¸­çš„ä»·æ ¼å–‚ä»·åœ°å€ï¼š
1. è®¿é—® [Chainlink æ•°æ®å–‚ä»·æ–‡æ¡£](https://docs.chain.link/data-feeds/price-feeds/addresses/)
2. é€‰æ‹©ç›®æ ‡ç½‘ç»œçš„ä»·æ ¼å–‚ä»·åœ°å€
3. åœ¨ `scripts/deploy.js` ä¸­æ›´æ–°åœ°å€

## Contract Upgrades ğŸ”„

### å‡çº§æµç¨‹
1. éƒ¨ç½²æ–°ç‰ˆæœ¬çš„å®ç°åˆçº¦
2. åœ¨æµ‹è¯•ç½‘è¿›è¡Œå…¨é¢æµ‹è¯•
3. é€šè¿‡ä»£ç†æ‰§è¡Œå‡çº§

```bash
npx hardhat run scripts/upgrade.js --network <network>
```

### å‡çº§æ³¨æ„äº‹é¡¹
- ç¡®ä¿å­˜å‚¨å¸ƒå±€å…¼å®¹æ€§
- ä½¿ç”¨å‰å‘å…¼å®¹æ€§æ£€æŸ¥
- åœ¨ç”Ÿäº§å‡çº§å‰è¿›è¡Œå®Œæ•´å®¡è®¡

## Testing Details ğŸ§ª

### æµ‹è¯•è¦†ç›–èŒƒå›´
- **NFT åˆçº¦æµ‹è¯•**: é“¸é€ ã€è½¬ç§»ã€æ‹å–é›†æˆã€æƒé™æ§åˆ¶
- **ä»£å¸åˆçº¦æµ‹è¯•**: ERC20 åŠŸèƒ½ã€è½¬è´¦ã€é“¸å¸
- **æ‹å–å¸‚åœºæµ‹è¯•**: å®Œæ•´æ‹å–ç”Ÿå‘½å‘¨æœŸã€å‡ºä»·ã€é€€æ¬¾ã€æƒé™ç®¡ç†

### è¿è¡Œæµ‹è¯•
```bash
# æœ¬åœ°æµ‹è¯•
npm test

# æµ‹è¯•è¦†ç›–ç‡
npm run coverage

# ç‰¹å®šæµ‹è¯•æ–‡ä»¶
npx hardhat test test/NFT.test.js
```

### æµ‹è¯•åœºæ™¯è¦†ç›–
- âœ… åˆçº¦éƒ¨ç½²å’ŒåŸºæœ¬è®¾ç½®
- âœ… NFT é“¸é€ å’Œå…ƒæ•°æ®ç®¡ç†
- âœ… æ‹å–åˆ›å»ºå’ŒéªŒè¯
- âœ… ETH å‡ºä»·åŠŸèƒ½
- âœ… ERC20 å‡ºä»·åŠŸèƒ½
- âœ… æ‹å–ç»“æŸå’Œèµ„é‡‘åˆ†é…
- âœ… é€€æ¬¾æœºåˆ¶
- âœ… æƒé™æ§åˆ¶å’Œè®¿é—®é™åˆ¶
- âœ… é”™è¯¯å¤„ç†å’Œè¾¹ç•Œæƒ…å†µ

## Security Features ğŸ”’

### å®‰å…¨å®ç°
- **é‡å…¥ä¿æŠ¤**: æ‰€æœ‰çŠ¶æ€æ›´æ”¹å‡½æ•°ä½¿ç”¨ ReentrancyGuard
- **æƒé™æ§åˆ¶**: Ownable æ¨¡å¼ä¿æŠ¤å…³é”®åŠŸèƒ½
- **è¾“å…¥éªŒè¯**: æ‰€æœ‰å¤–éƒ¨å‡½æ•°çš„å‚æ•°éªŒè¯
- **å®‰å…¨æ•°å­¦**: Solidity 0.8+ å†…ç½®æº¢å‡ºä¿æŠ¤
- **äº‹ä»¶æ—¥å¿—**: å®Œæ•´çš„çŠ¶æ€å˜æ›´è®°å½•
- **ç´§æ€¥ææ¬¾**: æ‰€æœ‰è€…å¯æå–æ»ç•™èµ„é‡‘

### å®‰å…¨æœ€ä½³å®è·µ
- ä½¿ç”¨ OpenZeppelin æ ‡å‡†åº“
- å…¨é¢çš„å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
- è¾“å…¥éªŒè¯å’Œè¾¹ç•Œæ£€æŸ¥
- é€‚å½“çš„é”™è¯¯æ¶ˆæ¯å’Œå›æ»š
- äº‹ä»¶é©±åŠ¨çš„é€æ˜æ“ä½œ

## Gas Optimization â›½

### ä¼˜åŒ–ç­–ç•¥
- é«˜æ•ˆçš„å­˜å‚¨å¸ƒå±€è®¾è®¡
- æœ€å°çš„ SSTORE æ“ä½œ
- æ‰¹é‡æ“ä½œæ”¯æŒ
- ä»£ç†æ¨¡å¼é¿å…æ•°æ®è¿ç§»
- å¾ªç¯å’Œæ•°ç»„çš„ä¼˜åŒ–ä½¿ç”¨

## Production Deployment Checklist âœ…

- [ ] ç”¨çœŸå®çš„ Chainlink å–‚ä»·åœ°å€æ›¿æ¢æ¨¡æ‹Ÿåœ°å€
- [ ] è¿›è¡Œå…¨é¢çš„å®‰å…¨å®¡è®¡
- [ ] åœ¨æµ‹è¯•ç½‘ä¸Šè¿›è¡Œå¹¿æ³›æµ‹è¯•
- [ ] è®¾ç½®é€‚å½“çš„ç›‘æ§å’Œè­¦æŠ¥ç³»ç»Ÿ
- [ ] ä¸ºå…³é”®æ“ä½œå®æ–½å¤šé‡ç­¾å
- [ ] é…ç½®åˆé€‚çš„å¹³å°è´¹ç”¨
- [ ] ä½¿ç”¨æ­£ç¡®çš„ Gas é™åˆ¶éƒ¨ç½²åˆ°ä¸»ç½‘
- [ ] éªŒè¯åˆçº¦ä»£ç 
- [ ] å»ºç«‹ç´§æ€¥æƒ…å†µå¤„ç†æµç¨‹

## License ğŸ“„

MIT License - è¯¦è§ SPDX è®¸å¯è¯æ ‡è¯†ç¬¦

## Contributing ğŸ¤

1. Fork ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/amazing-feature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some amazing feature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/amazing-feature`)
5. å¼€ Pull Request

## Support ğŸ’¬

å¯¹äºæ”¯æŒå’Œé—®é¢˜:
- åœ¨ä»“åº“ä¸­åˆ›å»º Issue
- æŸ¥é˜…æ–‡æ¡£å’Œæµ‹è¯•ç”¨ä¾‹
- æŸ¥çœ‹åˆçº¦æ³¨é‡Šäº†è§£è¯¦ç»†å®ç°

## Acknowledgments ğŸ™

- OpenZeppelin - å®‰å…¨åˆçº¦åº“å’Œå‡çº§æ¡†æ¶
- Chainlink - å»ä¸­å¿ƒåŒ–é¢„è¨€æœºç½‘ç»œ
- Hardhat - ä¼˜ç§€çš„å¼€å‘æ¡†æ¶
- Ethereum ç¤¾åŒº - æœ€ä½³å®è·µå’Œæ ‡å‡†

---

**æ³¨æ„**: è¿™æ˜¯ä¸€ä¸ªæ•™è‚²æ€§è´¨çš„é¡¹ç›®ï¼Œç”¨äºå­¦ä¹  Solidity ç¼–ç¨‹å’Œæ™ºèƒ½åˆçº¦å¼€å‘ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨å‰è¯·è¿›è¡Œå……åˆ†çš„å®‰å…¨å®¡è®¡å’Œæµ‹è¯•ã€‚**

